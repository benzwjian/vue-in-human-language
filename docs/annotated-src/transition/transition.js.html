<!DOCTYPE html>
<html>
<head>
    <title>transition</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta name="viewport"
        content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
    
    <link rel="stylesheet"
        media="all"
        href="../../assets/file_1.css"/>
    
    <link rel="stylesheet"
        media="all"
        href="../../assets/file_5.css"/>
    
    <link rel="stylesheet"
        media="all"
        href="../../assets/32px.png"/>
    
    <link rel="stylesheet"
        media="all"
        href="../../assets/40px.png"/>
    
    <link rel="stylesheet"
        media="all"
        href="../../assets/throbber.gif"/>
    
    <link rel="stylesheet"
        media="all"
        href="../../assets/file_7.css"/>
    
    <link rel="stylesheet"
        media="all"
        href="../../assets/file_8.css"/>
    

    
    <script src="../../assets/file_2.js"
        type="text/javascript"></script>
    
    <script src="../../assets/file_3.js"
        type="text/javascript"></script>
    
    <script src="../../assets/file_4.js"
        type="text/javascript"></script>
    
    <script src="../../assets/file_6.js"
        type="text/javascript"></script>
    

    <script type="application/json" id="jsTreeJSON">
        [{"id":"annotated-src/filters/array-filters.js","text":"array-filters.js","icon":"jstree-file","parent":"annotated-src/filters","a_attr":{"href":"../filters/array-filters.js.html"},"state":{"selected":false}},{"id":"annotated-src","text":"annotated-src","icon":"jstree-folder","parent":"#","a_attr":{"href":".."},"state":{"opened":true}},{"id":"annotated-src/cache.js","text":"cache.js","icon":"jstree-file","parent":"annotated-src","a_attr":{"href":"../cache.js.html"},"state":{"selected":false}},{"id":"annotated-src/compiler","text":"compiler","icon":"jstree-folder","parent":"annotated-src","a_attr":{"href":"../compiler"},"state":{"opened":false}},{"id":"annotated-src/compiler/compile-props.js","text":"compile-props.js","icon":"jstree-file","parent":"annotated-src/compiler","a_attr":{"href":"../compiler/compile-props.js.html"},"state":{"selected":false}},{"id":"annotated-src/compiler/compile.js","text":"compile.js","icon":"jstree-file","parent":"annotated-src/compiler","a_attr":{"href":"../compiler/compile.js.html"},"state":{"selected":false}},{"id":"annotated-src/compiler/index.js","text":"index.js","icon":"jstree-file","parent":"annotated-src/compiler","a_attr":{"href":"../compiler/index.js.html"},"state":{"selected":false}},{"id":"annotated-src/compiler/resolve-slots.js","text":"resolve-slots.js","icon":"jstree-file","parent":"annotated-src/compiler","a_attr":{"href":"../compiler/resolve-slots.js.html"},"state":{"selected":false}},{"id":"annotated-src/compiler/transclude.js","text":"transclude.js","icon":"jstree-file","parent":"annotated-src/compiler","a_attr":{"href":"../compiler/transclude.js.html"},"state":{"selected":false}},{"id":"annotated-src/config.js","text":"config.js","icon":"jstree-file","parent":"annotated-src","a_attr":{"href":"../config.js.html"},"state":{"selected":false}},{"id":"annotated-src/directive.js","text":"directive.js","icon":"jstree-file","parent":"annotated-src","a_attr":{"href":"../directive.js.html"},"state":{"selected":false}},{"id":"annotated-src/directives","text":"directives","icon":"jstree-folder","parent":"annotated-src","a_attr":{"href":"../directives"},"state":{"opened":false}},{"id":"annotated-src/directives/element","text":"element","icon":"jstree-folder","parent":"annotated-src/directives","a_attr":{"href":"../directives/element"},"state":{"opened":false}},{"id":"annotated-src/directives/element/index.js","text":"index.js","icon":"jstree-file","parent":"annotated-src/directives/element","a_attr":{"href":"../directives/element/index.js.html"},"state":{"selected":false}},{"id":"annotated-src/directives/element/partial.js","text":"partial.js","icon":"jstree-file","parent":"annotated-src/directives/element","a_attr":{"href":"../directives/element/partial.js.html"},"state":{"selected":false}},{"id":"annotated-src/directives/element/slot.js","text":"slot.js","icon":"jstree-file","parent":"annotated-src/directives/element","a_attr":{"href":"../directives/element/slot.js.html"},"state":{"selected":false}},{"id":"annotated-src/directives/internal","text":"internal","icon":"jstree-folder","parent":"annotated-src/directives","a_attr":{"href":"../directives/internal"},"state":{"opened":false}},{"id":"annotated-src/directives/internal/class.js","text":"class.js","icon":"jstree-file","parent":"annotated-src/directives/internal","a_attr":{"href":"../directives/internal/class.js.html"},"state":{"selected":false}},{"id":"annotated-src/directives/internal/component.js","text":"component.js","icon":"jstree-file","parent":"annotated-src/directives/internal","a_attr":{"href":"../directives/internal/component.js.html"},"state":{"selected":false}},{"id":"annotated-src/directives/internal/index.js","text":"index.js","icon":"jstree-file","parent":"annotated-src/directives/internal","a_attr":{"href":"../directives/internal/index.js.html"},"state":{"selected":false}},{"id":"annotated-src/directives/internal/prop.js","text":"prop.js","icon":"jstree-file","parent":"annotated-src/directives/internal","a_attr":{"href":"../directives/internal/prop.js.html"},"state":{"selected":false}},{"id":"annotated-src/directives/internal/style.js","text":"style.js","icon":"jstree-file","parent":"annotated-src/directives/internal","a_attr":{"href":"../directives/internal/style.js.html"},"state":{"selected":false}},{"id":"annotated-src/directives/internal/transition.js","text":"transition.js","icon":"jstree-file","parent":"annotated-src/directives/internal","a_attr":{"href":"../directives/internal/transition.js.html"},"state":{"selected":false}},{"id":"annotated-src/directives/priorities.js","text":"priorities.js","icon":"jstree-file","parent":"annotated-src/directives","a_attr":{"href":"../directives/priorities.js.html"},"state":{"selected":false}},{"id":"annotated-src/directives/public","text":"public","icon":"jstree-folder","parent":"annotated-src/directives","a_attr":{"href":"../directives/public"},"state":{"opened":false}},{"id":"annotated-src/directives/public/bind.js","text":"bind.js","icon":"jstree-file","parent":"annotated-src/directives/public","a_attr":{"href":"../directives/public/bind.js.html"},"state":{"selected":false}},{"id":"annotated-src/directives/public/cloak.js","text":"cloak.js","icon":"jstree-file","parent":"annotated-src/directives/public","a_attr":{"href":"../directives/public/cloak.js.html"},"state":{"selected":false}},{"id":"annotated-src/directives/public/el.js","text":"el.js","icon":"jstree-file","parent":"annotated-src/directives/public","a_attr":{"href":"../directives/public/el.js.html"},"state":{"selected":false}},{"id":"annotated-src/directives/public/for.js","text":"for.js","icon":"jstree-file","parent":"annotated-src/directives/public","a_attr":{"href":"../directives/public/for.js.html"},"state":{"selected":false}},{"id":"annotated-src/directives/public/html.js","text":"html.js","icon":"jstree-file","parent":"annotated-src/directives/public","a_attr":{"href":"../directives/public/html.js.html"},"state":{"selected":false}},{"id":"annotated-src/directives/public/if.js","text":"if.js","icon":"jstree-file","parent":"annotated-src/directives/public","a_attr":{"href":"../directives/public/if.js.html"},"state":{"selected":false}},{"id":"annotated-src/directives/public/index.js","text":"index.js","icon":"jstree-file","parent":"annotated-src/directives/public","a_attr":{"href":"../directives/public/index.js.html"},"state":{"selected":false}},{"id":"annotated-src/directives/public/model","text":"model","icon":"jstree-folder","parent":"annotated-src/directives/public","a_attr":{"href":"../directives/public/model"},"state":{"opened":false}},{"id":"annotated-src/directives/public/model/checkbox.js","text":"checkbox.js","icon":"jstree-file","parent":"annotated-src/directives/public/model","a_attr":{"href":"../directives/public/model/checkbox.js.html"},"state":{"selected":false}},{"id":"annotated-src/directives/public/model/index.js","text":"index.js","icon":"jstree-file","parent":"annotated-src/directives/public/model","a_attr":{"href":"../directives/public/model/index.js.html"},"state":{"selected":false}},{"id":"annotated-src/directives/public/model/radio.js","text":"radio.js","icon":"jstree-file","parent":"annotated-src/directives/public/model","a_attr":{"href":"../directives/public/model/radio.js.html"},"state":{"selected":false}},{"id":"annotated-src/directives/public/model/select.js","text":"select.js","icon":"jstree-file","parent":"annotated-src/directives/public/model","a_attr":{"href":"../directives/public/model/select.js.html"},"state":{"selected":false}},{"id":"annotated-src/directives/public/model/text.js","text":"text.js","icon":"jstree-file","parent":"annotated-src/directives/public/model","a_attr":{"href":"../directives/public/model/text.js.html"},"state":{"selected":false}},{"id":"annotated-src/directives/public/on.js","text":"on.js","icon":"jstree-file","parent":"annotated-src/directives/public","a_attr":{"href":"../directives/public/on.js.html"},"state":{"selected":false}},{"id":"annotated-src/directives/public/ref.js","text":"ref.js","icon":"jstree-file","parent":"annotated-src/directives/public","a_attr":{"href":"../directives/public/ref.js.html"},"state":{"selected":false}},{"id":"annotated-src/directives/public/show.js","text":"show.js","icon":"jstree-file","parent":"annotated-src/directives/public","a_attr":{"href":"../directives/public/show.js.html"},"state":{"selected":false}},{"id":"annotated-src/directives/public/text.js","text":"text.js","icon":"jstree-file","parent":"annotated-src/directives/public","a_attr":{"href":"../directives/public/text.js.html"},"state":{"selected":false}},{"id":"annotated-src/filters","text":"filters","icon":"jstree-folder","parent":"annotated-src","a_attr":{"href":"../filters"},"state":{"opened":false}},{"id":"annotated-src/batcher.js","text":"batcher.js","icon":"jstree-file","parent":"annotated-src","a_attr":{"href":"../batcher.js.html"},"state":{"selected":false}},{"id":"annotated-src/filters/index.js","text":"index.js","icon":"jstree-file","parent":"annotated-src/filters","a_attr":{"href":"../filters/index.js.html"},"state":{"selected":false}},{"id":"annotated-src/fragment","text":"fragment","icon":"jstree-folder","parent":"annotated-src","a_attr":{"href":"../fragment"},"state":{"opened":false}},{"id":"annotated-src/fragment/factory.js","text":"factory.js","icon":"jstree-file","parent":"annotated-src/fragment","a_attr":{"href":"../fragment/factory.js.html"},"state":{"selected":false}},{"id":"annotated-src/fragment/fragment.js","text":"fragment.js","icon":"jstree-file","parent":"annotated-src/fragment","a_attr":{"href":"../fragment/fragment.js.html"},"state":{"selected":false}},{"id":"annotated-src/global-api.js","text":"global-api.js","icon":"jstree-file","parent":"annotated-src","a_attr":{"href":"../global-api.js.html"},"state":{"selected":false}},{"id":"annotated-src/index.js","text":"index.js","icon":"jstree-file","parent":"annotated-src","a_attr":{"href":"../index.js.html"},"state":{"selected":false}},{"id":"annotated-src/instance","text":"instance","icon":"jstree-folder","parent":"annotated-src","a_attr":{"href":"../instance"},"state":{"opened":false}},{"id":"annotated-src/instance/api","text":"api","icon":"jstree-folder","parent":"annotated-src/instance","a_attr":{"href":"../instance/api"},"state":{"opened":false}},{"id":"annotated-src/instance/api/data.js","text":"data.js","icon":"jstree-file","parent":"annotated-src/instance/api","a_attr":{"href":"../instance/api/data.js.html"},"state":{"selected":false}},{"id":"annotated-src/instance/api/dom.js","text":"dom.js","icon":"jstree-file","parent":"annotated-src/instance/api","a_attr":{"href":"../instance/api/dom.js.html"},"state":{"selected":false}},{"id":"annotated-src/instance/api/events.js","text":"events.js","icon":"jstree-file","parent":"annotated-src/instance/api","a_attr":{"href":"../instance/api/events.js.html"},"state":{"selected":false}},{"id":"annotated-src/instance/api/lifecycle.js","text":"lifecycle.js","icon":"jstree-file","parent":"annotated-src/instance/api","a_attr":{"href":"../instance/api/lifecycle.js.html"},"state":{"selected":false}},{"id":"annotated-src/instance/internal","text":"internal","icon":"jstree-folder","parent":"annotated-src/instance","a_attr":{"href":"../instance/internal"},"state":{"opened":false}},{"id":"annotated-src/instance/internal/events.js","text":"events.js","icon":"jstree-file","parent":"annotated-src/instance/internal","a_attr":{"href":"../instance/internal/events.js.html"},"state":{"selected":false}},{"id":"annotated-src/instance/internal/init.js","text":"init.js","icon":"jstree-file","parent":"annotated-src/instance/internal","a_attr":{"href":"../instance/internal/init.js.html"},"state":{"selected":false}},{"id":"annotated-src/instance/internal/lifecycle.js","text":"lifecycle.js","icon":"jstree-file","parent":"annotated-src/instance/internal","a_attr":{"href":"../instance/internal/lifecycle.js.html"},"state":{"selected":false}},{"id":"annotated-src/instance/internal/misc.js","text":"misc.js","icon":"jstree-file","parent":"annotated-src/instance/internal","a_attr":{"href":"../instance/internal/misc.js.html"},"state":{"selected":false}},{"id":"annotated-src/instance/internal/state.js","text":"state.js","icon":"jstree-file","parent":"annotated-src/instance/internal","a_attr":{"href":"../instance/internal/state.js.html"},"state":{"selected":false}},{"id":"annotated-src/instance/vue.js","text":"vue.js","icon":"jstree-file","parent":"annotated-src/instance","a_attr":{"href":"../instance/vue.js.html"},"state":{"selected":false}},{"id":"annotated-src/observer","text":"observer","icon":"jstree-folder","parent":"annotated-src","a_attr":{"href":"../observer"},"state":{"opened":false}},{"id":"annotated-src/observer/array.js","text":"array.js","icon":"jstree-file","parent":"annotated-src/observer","a_attr":{"href":"../observer/array.js.html"},"state":{"selected":false}},{"id":"annotated-src/observer/dep.js","text":"dep.js","icon":"jstree-file","parent":"annotated-src/observer","a_attr":{"href":"../observer/dep.js.html"},"state":{"selected":false}},{"id":"annotated-src/observer/index.js","text":"index.js","icon":"jstree-file","parent":"annotated-src/observer","a_attr":{"href":"../observer/index.js.html"},"state":{"selected":false}},{"id":"annotated-src/parsers","text":"parsers","icon":"jstree-folder","parent":"annotated-src","a_attr":{"href":"../parsers"},"state":{"opened":false}},{"id":"annotated-src/parsers/directive.js","text":"directive.js","icon":"jstree-file","parent":"annotated-src/parsers","a_attr":{"href":"../parsers/directive.js.html"},"state":{"selected":false}},{"id":"annotated-src/parsers/expression.js","text":"expression.js","icon":"jstree-file","parent":"annotated-src/parsers","a_attr":{"href":"../parsers/expression.js.html"},"state":{"selected":false}},{"id":"annotated-src/parsers/path.js","text":"path.js","icon":"jstree-file","parent":"annotated-src/parsers","a_attr":{"href":"../parsers/path.js.html"},"state":{"selected":false}},{"id":"annotated-src/parsers/template.js","text":"template.js","icon":"jstree-file","parent":"annotated-src/parsers","a_attr":{"href":"../parsers/template.js.html"},"state":{"selected":false}},{"id":"annotated-src/parsers/text.js","text":"text.js","icon":"jstree-file","parent":"annotated-src/parsers","a_attr":{"href":"../parsers/text.js.html"},"state":{"selected":false}},{"id":"annotated-src/transition","text":"transition","icon":"jstree-folder","parent":"annotated-src","a_attr":{"href":"."},"state":{"opened":true}},{"id":"annotated-src/transition/index.js","text":"index.js","icon":"jstree-file","parent":"annotated-src/transition","a_attr":{"href":"index.js.html"},"state":{"selected":false}},{"id":"annotated-src/transition/queue.js","text":"queue.js","icon":"jstree-file","parent":"annotated-src/transition","a_attr":{"href":"queue.js.html"},"state":{"selected":false}},{"id":"annotated-src/transition/transition.js","text":"transition.js","icon":"jstree-file","parent":"annotated-src/transition","a_attr":{"href":"transition.js.html"},"state":{"selected":true}},{"id":"annotated-src/util","text":"util","icon":"jstree-folder","parent":"annotated-src","a_attr":{"href":"../util"},"state":{"opened":false}},{"id":"annotated-src/util/component.js","text":"component.js","icon":"jstree-file","parent":"annotated-src/util","a_attr":{"href":"../util/component.js.html"},"state":{"selected":false}},{"id":"annotated-src/util/debug.js","text":"debug.js","icon":"jstree-file","parent":"annotated-src/util","a_attr":{"href":"../util/debug.js.html"},"state":{"selected":false}},{"id":"annotated-src/util/dom.js","text":"dom.js","icon":"jstree-file","parent":"annotated-src/util","a_attr":{"href":"../util/dom.js.html"},"state":{"selected":false}},{"id":"annotated-src/util/env.js","text":"env.js","icon":"jstree-file","parent":"annotated-src/util","a_attr":{"href":"../util/env.js.html"},"state":{"selected":false}},{"id":"annotated-src/util/index.js","text":"index.js","icon":"jstree-file","parent":"annotated-src/util","a_attr":{"href":"../util/index.js.html"},"state":{"selected":false}},{"id":"annotated-src/util/lang.js","text":"lang.js","icon":"jstree-file","parent":"annotated-src/util","a_attr":{"href":"../util/lang.js.html"},"state":{"selected":false}},{"id":"annotated-src/util/options.js","text":"options.js","icon":"jstree-file","parent":"annotated-src/util","a_attr":{"href":"../util/options.js.html"},"state":{"selected":false}},{"id":"annotated-src/watcher.js","text":"watcher.js","icon":"jstree-file","parent":"annotated-src","a_attr":{"href":"../watcher.js.html"},"state":{"selected":false}}]
    </script>
</head>
<body class="markdown-body">
<h1>
    transition
</h1>
<div class="subHeading">
    annotated-src/transition/transition.js
</div>
<button type="button" class="navigatorToggle">&#9776; files...</button>
<nav class="navigationTree minimized">
    <input type="text" id="jsTreeSearch" placeholder="search..."/>
    <div></div>
</nav>
<section>
    <ul class="sectionDetails codeOnly">
        
        
        <li id="section-1">
            <div class="annotation">
                
            </div><div class="content">
                <div class="highlight"><pre><span class="hljs-keyword">import</span> { pushJob } <span class="hljs-keyword">from</span> <span class="hljs-string">'./queue'</span>
<span class="hljs-keyword">import</span> {
  on,
  off,
  bind,
  addClass,
  removeClass,
  cancellable,
  transitionEndEvent,
  animationEndEvent,
  transitionProp,
  animationProp,
  warn,
  inBrowser
} <span class="hljs-keyword">from</span> <span class="hljs-string">'../util/index'</span>

<span class="hljs-keyword">const</span> TYPE_TRANSITION = <span class="hljs-string">'transition'</span>
<span class="hljs-keyword">const</span> TYPE_ANIMATION = <span class="hljs-string">'animation'</span>
<span class="hljs-keyword">const</span> transDurationProp = transitionProp + <span class="hljs-string">'Duration'</span>
<span class="hljs-keyword">const</span> animDurationProp = animationProp + <span class="hljs-string">'Duration'</span>

<span class="hljs-comment">/**
 * If a just-entered element is applied the
 * leave class while its enter transition hasn't started yet,
 * and the transitioned property has the same value for both
 * enter/leave, then the leave transition will be skipped and
 * the transitionend event never fires. This function ensures
 * its callback to be called after a transition has started
 * by waiting for double raf.
 *
 * It falls back to setTimeout on devices that support CSS
 * transitions but not raf (e.g. Android 4.2 browser) - since
 * these environments are usually slow, we are giving it a
 * relatively large timeout.
 */</span>

<span class="hljs-keyword">const</span> raf = inBrowser &amp;&amp; <span class="hljs-built_in">window</span>.requestAnimationFrame
<span class="hljs-keyword">const</span> waitForTransitionStart = raf
  <span class="hljs-comment">/* istanbul ignore next */</span>
  ? <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">fn</span>) </span>{ raf(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ raf(fn) }) }
  : <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">fn</span>) </span>{ setTimeout(fn, <span class="hljs-number">50</span>) }

<span class="hljs-comment">/**
 * A Transition object that encapsulates the state and logic
 * of the transition.
 *
 * @param {Element} el
 * @param {String} id
 * @param {Object} hooks
 * @param {Vue} vm
 */</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Transition</span> (<span class="hljs-params">el, id, hooks, vm</span>) </span>{
  <span class="hljs-keyword">this</span>.id = id
  <span class="hljs-keyword">this</span>.el = el
  <span class="hljs-keyword">this</span>.enterClass = (hooks &amp;&amp; hooks.enterClass) || id + <span class="hljs-string">'-enter'</span>
  <span class="hljs-keyword">this</span>.leaveClass = (hooks &amp;&amp; hooks.leaveClass) || id + <span class="hljs-string">'-leave'</span>
  <span class="hljs-keyword">this</span>.hooks = hooks
  <span class="hljs-keyword">this</span>.vm = vm
  <span class="hljs-comment">/* async state */</span>
  <span class="hljs-keyword">this</span>.pendingCssEvent =
  <span class="hljs-keyword">this</span>.pendingCssCb =
  <span class="hljs-keyword">this</span>.cancel =
  <span class="hljs-keyword">this</span>.pendingJsCb =
  <span class="hljs-keyword">this</span>.op =
  <span class="hljs-keyword">this</span>.cb = <span class="hljs-literal">null</span>
  <span class="hljs-keyword">this</span>.justEntered = <span class="hljs-literal">false</span>
  <span class="hljs-keyword">this</span>.entered = <span class="hljs-keyword">this</span>.left = <span class="hljs-literal">false</span>
  <span class="hljs-keyword">this</span>.typeCache = {}
  <span class="hljs-comment">/* check css transition type */</span>
  <span class="hljs-keyword">this</span>.type = hooks &amp;&amp; hooks.type
  <span class="hljs-comment">/* istanbul ignore if */</span>
  <span class="hljs-keyword">if</span> (process.env.NODE_ENV !== <span class="hljs-string">'production'</span>) {
    <span class="hljs-keyword">if</span> (
      <span class="hljs-keyword">this</span>.type &amp;&amp;
      <span class="hljs-keyword">this</span>.type !== TYPE_TRANSITION &amp;&amp;
      <span class="hljs-keyword">this</span>.type !== TYPE_ANIMATION
    ) {
      warn(
        <span class="hljs-string">'invalid CSS transition type for transition="'</span> +
        <span class="hljs-keyword">this</span>.id + <span class="hljs-string">'": '</span> + <span class="hljs-keyword">this</span>.type,
        vm
      )
    }
  }
  <span class="hljs-comment">/* bind */</span>
  <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>
  ;[<span class="hljs-string">'enterNextTick'</span>, <span class="hljs-string">'enterDone'</span>, <span class="hljs-string">'leaveNextTick'</span>, <span class="hljs-string">'leaveDone'</span>]
    .forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">m</span>) </span>{
      self[m] = bind(self[m], self)
    })
}

<span class="hljs-keyword">var</span> p = Transition.prototype

<span class="hljs-comment">/**
 * Start an entering transition.
 *
 * 1. enter transition triggered
 * 2. call beforeEnter hook
 * 3. add enter class
 * 4. insert/show element
 * 5. call enter hook (with possible explicit js callback)
 * 6. reflow
 * 7. based on transition type:
 *    - transition:
 *        remove class now, wait for transitionend,
 *        then done if there's no explicit js callback.
 *    - animation:
 *        wait for animationend, remove class,
 *        then done if there's no explicit js callback.
 *    - no css transition:
 *        done now if there's no explicit js callback.
 * 8. wait for either done or js callback, then call
 *    afterEnter hook.
 *
 * @param {Function} op - insert/show the element
 * @param {Function} [cb]
 */</span>

p.enter = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">op, cb</span>) </span>{
  <span class="hljs-keyword">this</span>.cancelPending()
  <span class="hljs-keyword">this</span>.callHook(<span class="hljs-string">'beforeEnter'</span>)
  <span class="hljs-keyword">this</span>.cb = cb
  addClass(<span class="hljs-keyword">this</span>.el, <span class="hljs-keyword">this</span>.enterClass)
  op()
  <span class="hljs-keyword">this</span>.entered = <span class="hljs-literal">false</span>
  <span class="hljs-keyword">this</span>.callHookWithCb(<span class="hljs-string">'enter'</span>)
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.entered) {
    <span class="hljs-keyword">return</span> <span class="hljs-comment">/* user called done synchronously. */</span>
  }
  <span class="hljs-keyword">this</span>.cancel = <span class="hljs-keyword">this</span>.hooks &amp;&amp; <span class="hljs-keyword">this</span>.hooks.enterCancelled
  pushJob(<span class="hljs-keyword">this</span>.enterNextTick)
}

<span class="hljs-comment">/**
 * The "nextTick" phase of an entering transition, which is
 * to be pushed into a queue and executed after a reflow so
 * that removing the class can trigger a CSS transition.
 */</span>

p.enterNextTick = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
  <span class="hljs-comment">/* prevent transition skipping */</span>
  <span class="hljs-keyword">this</span>.justEntered = <span class="hljs-literal">true</span>
  waitForTransitionStart(() =&gt; {
    <span class="hljs-keyword">this</span>.justEntered = <span class="hljs-literal">false</span>
  })
  <span class="hljs-keyword">var</span> enterDone = <span class="hljs-keyword">this</span>.enterDone
  <span class="hljs-keyword">var</span> type = <span class="hljs-keyword">this</span>.getCssTransitionType(<span class="hljs-keyword">this</span>.enterClass)
  <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.pendingJsCb) {
    <span class="hljs-keyword">if</span> (type === TYPE_TRANSITION) {
      <span class="hljs-comment">/* trigger transition by removing enter class now */</span>
      removeClass(<span class="hljs-keyword">this</span>.el, <span class="hljs-keyword">this</span>.enterClass)
      <span class="hljs-keyword">this</span>.setupCssCb(transitionEndEvent, enterDone)
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (type === TYPE_ANIMATION) {
      <span class="hljs-keyword">this</span>.setupCssCb(animationEndEvent, enterDone)
    } <span class="hljs-keyword">else</span> {
      enterDone()
    }
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (type === TYPE_TRANSITION) {
    removeClass(<span class="hljs-keyword">this</span>.el, <span class="hljs-keyword">this</span>.enterClass)
  }
}

<span class="hljs-comment">/**
 * The "cleanup" phase of an entering transition.
 */</span>

p.enterDone = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">this</span>.entered = <span class="hljs-literal">true</span>
  <span class="hljs-keyword">this</span>.cancel = <span class="hljs-keyword">this</span>.pendingJsCb = <span class="hljs-literal">null</span>
  removeClass(<span class="hljs-keyword">this</span>.el, <span class="hljs-keyword">this</span>.enterClass)
  <span class="hljs-keyword">this</span>.callHook(<span class="hljs-string">'afterEnter'</span>)
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.cb) <span class="hljs-keyword">this</span>.cb()
}

<span class="hljs-comment">/**
 * Start a leaving transition.
 *
 * 1. leave transition triggered.
 * 2. call beforeLeave hook
 * 3. add leave class (trigger css transition)
 * 4. call leave hook (with possible explicit js callback)
 * 5. reflow if no explicit js callback is provided
 * 6. based on transition type:
 *    - transition or animation:
 *        wait for end event, remove class, then done if
 *        there's no explicit js callback.
 *    - no css transition:
 *        done if there's no explicit js callback.
 * 7. wait for either done or js callback, then call
 *    afterLeave hook.
 *
 * @param {Function} op - remove/hide the element
 * @param {Function} [cb]
 */</span>

p.leave = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">op, cb</span>) </span>{
  <span class="hljs-keyword">this</span>.cancelPending()
  <span class="hljs-keyword">this</span>.callHook(<span class="hljs-string">'beforeLeave'</span>)
  <span class="hljs-keyword">this</span>.op = op
  <span class="hljs-keyword">this</span>.cb = cb
  addClass(<span class="hljs-keyword">this</span>.el, <span class="hljs-keyword">this</span>.leaveClass)
  <span class="hljs-keyword">this</span>.left = <span class="hljs-literal">false</span>
  <span class="hljs-keyword">this</span>.callHookWithCb(<span class="hljs-string">'leave'</span>)
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.left) {
    <span class="hljs-keyword">return</span> <span class="hljs-comment">/* user called done synchronously. */</span>
  }
  <span class="hljs-keyword">this</span>.cancel = <span class="hljs-keyword">this</span>.hooks &amp;&amp; <span class="hljs-keyword">this</span>.hooks.leaveCancelled
  <span class="hljs-comment">/* only need to handle leaveDone if */</span>
  <span class="hljs-comment">/* 1. the transition is already done (synchronously called */</span>
  <span class="hljs-comment">/*    by the user, which causes this.op set to null) */</span>
  <span class="hljs-comment">/* 2. there's no explicit js callback */</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.op &amp;&amp; !<span class="hljs-keyword">this</span>.pendingJsCb) {
    <span class="hljs-comment">/* if a CSS transition leaves immediately after enter, */</span>
    <span class="hljs-comment">/* the transitionend event never fires. therefore we */</span>
    <span class="hljs-comment">/* detect such cases and end the leave immediately. */</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.justEntered) {
      <span class="hljs-keyword">this</span>.leaveDone()
    } <span class="hljs-keyword">else</span> {
      pushJob(<span class="hljs-keyword">this</span>.leaveNextTick)
    }
  }
}

<span class="hljs-comment">/**
 * The "nextTick" phase of a leaving transition.
 */</span>

p.leaveNextTick = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">var</span> type = <span class="hljs-keyword">this</span>.getCssTransitionType(<span class="hljs-keyword">this</span>.leaveClass)
  <span class="hljs-keyword">if</span> (type) {
    <span class="hljs-keyword">var</span> event = type === TYPE_TRANSITION
      ? transitionEndEvent
      : animationEndEvent
    <span class="hljs-keyword">this</span>.setupCssCb(event, <span class="hljs-keyword">this</span>.leaveDone)
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">this</span>.leaveDone()
  }
}

<span class="hljs-comment">/**
 * The "cleanup" phase of a leaving transition.
 */</span>

p.leaveDone = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">this</span>.left = <span class="hljs-literal">true</span>
  <span class="hljs-keyword">this</span>.cancel = <span class="hljs-keyword">this</span>.pendingJsCb = <span class="hljs-literal">null</span>
  <span class="hljs-keyword">this</span>.op()
  removeClass(<span class="hljs-keyword">this</span>.el, <span class="hljs-keyword">this</span>.leaveClass)
  <span class="hljs-keyword">this</span>.callHook(<span class="hljs-string">'afterLeave'</span>)
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.cb) <span class="hljs-keyword">this</span>.cb()
  <span class="hljs-keyword">this</span>.op = <span class="hljs-literal">null</span>
}

<span class="hljs-comment">/**
 * Cancel any pending callbacks from a previously running
 * but not finished transition.
 */</span>

p.cancelPending = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">this</span>.op = <span class="hljs-keyword">this</span>.cb = <span class="hljs-literal">null</span>
  <span class="hljs-keyword">var</span> hasPending = <span class="hljs-literal">false</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.pendingCssCb) {
    hasPending = <span class="hljs-literal">true</span>
    off(<span class="hljs-keyword">this</span>.el, <span class="hljs-keyword">this</span>.pendingCssEvent, <span class="hljs-keyword">this</span>.pendingCssCb)
    <span class="hljs-keyword">this</span>.pendingCssEvent = <span class="hljs-keyword">this</span>.pendingCssCb = <span class="hljs-literal">null</span>
  }
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.pendingJsCb) {
    hasPending = <span class="hljs-literal">true</span>
    <span class="hljs-keyword">this</span>.pendingJsCb.cancel()
    <span class="hljs-keyword">this</span>.pendingJsCb = <span class="hljs-literal">null</span>
  }
  <span class="hljs-keyword">if</span> (hasPending) {
    removeClass(<span class="hljs-keyword">this</span>.el, <span class="hljs-keyword">this</span>.enterClass)
    removeClass(<span class="hljs-keyword">this</span>.el, <span class="hljs-keyword">this</span>.leaveClass)
  }
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.cancel) {
    <span class="hljs-keyword">this</span>.cancel.call(<span class="hljs-keyword">this</span>.vm, <span class="hljs-keyword">this</span>.el)
    <span class="hljs-keyword">this</span>.cancel = <span class="hljs-literal">null</span>
  }
}

<span class="hljs-comment">/**
 * Call a user-provided synchronous hook function.
 *
 * @param {String} type
 */</span>

p.callHook = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">type</span>) </span>{
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.hooks &amp;&amp; <span class="hljs-keyword">this</span>.hooks[type]) {
    <span class="hljs-keyword">this</span>.hooks[type].call(<span class="hljs-keyword">this</span>.vm, <span class="hljs-keyword">this</span>.el)
  }
}

<span class="hljs-comment">/**
 * Call a user-provided, potentially-async hook function.
 * We check for the length of arguments to see if the hook
 * expects a `done` callback. If true, the transition's end
 * will be determined by when the user calls that callback;
 * otherwise, the end is determined by the CSS transition or
 * animation.
 *
 * @param {String} type
 */</span>

p.callHookWithCb = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">type</span>) </span>{
  <span class="hljs-keyword">var</span> hook = <span class="hljs-keyword">this</span>.hooks &amp;&amp; <span class="hljs-keyword">this</span>.hooks[type]
  <span class="hljs-keyword">if</span> (hook) {
    <span class="hljs-keyword">if</span> (hook.length &gt; <span class="hljs-number">1</span>) {
      <span class="hljs-keyword">this</span>.pendingJsCb = cancellable(<span class="hljs-keyword">this</span>[type + <span class="hljs-string">'Done'</span>])
    }
    hook.call(<span class="hljs-keyword">this</span>.vm, <span class="hljs-keyword">this</span>.el, <span class="hljs-keyword">this</span>.pendingJsCb)
  }
}

<span class="hljs-comment">/**
 * Get an element's transition type based on the
 * calculated styles.
 *
 * @param {String} className
 * @return {Number}
 */</span>

p.getCssTransitionType = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">className</span>) </span>{
  <span class="hljs-comment">/* istanbul ignore if */</span>
  <span class="hljs-keyword">if</span> (
    !transitionEndEvent ||
    <span class="hljs-comment">/* skip CSS transitions if page is not visible - */</span>
    <span class="hljs-comment">/* this solves the issue of transitionend events not */</span>
    <span class="hljs-comment">/* firing until the page is visible again. */</span>
    <span class="hljs-comment">/* pageVisibility API is supported in IE10+, same as */</span>
    <span class="hljs-comment">/* CSS transitions. */</span>
    <span class="hljs-built_in">document</span>.hidden ||
    <span class="hljs-comment">/* explicit js-only transition */</span>
    (<span class="hljs-keyword">this</span>.hooks &amp;&amp; <span class="hljs-keyword">this</span>.hooks.css === <span class="hljs-literal">false</span>) ||
    <span class="hljs-comment">/* element is hidden */</span>
    isHidden(<span class="hljs-keyword">this</span>.el)
  ) {
    <span class="hljs-keyword">return</span>
  }
  <span class="hljs-keyword">var</span> type = <span class="hljs-keyword">this</span>.type || <span class="hljs-keyword">this</span>.typeCache[className]
  <span class="hljs-keyword">if</span> (type) <span class="hljs-keyword">return</span> type
  <span class="hljs-keyword">var</span> inlineStyles = <span class="hljs-keyword">this</span>.el.style
  <span class="hljs-keyword">var</span> computedStyles = <span class="hljs-built_in">window</span>.getComputedStyle(<span class="hljs-keyword">this</span>.el)
  <span class="hljs-keyword">var</span> transDuration =
    inlineStyles[transDurationProp] ||
    computedStyles[transDurationProp]
  <span class="hljs-keyword">if</span> (transDuration &amp;&amp; transDuration !== <span class="hljs-string">'0s'</span>) {
    type = TYPE_TRANSITION
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">var</span> animDuration =
      inlineStyles[animDurationProp] ||
      computedStyles[animDurationProp]
    <span class="hljs-keyword">if</span> (animDuration &amp;&amp; animDuration !== <span class="hljs-string">'0s'</span>) {
      type = TYPE_ANIMATION
    }
  }
  <span class="hljs-keyword">if</span> (type) {
    <span class="hljs-keyword">this</span>.typeCache[className] = type
  }
  <span class="hljs-keyword">return</span> type
}

<span class="hljs-comment">/**
 * Setup a CSS transitionend/animationend callback.
 *
 * @param {String} event
 * @param {Function} cb
 */</span>

p.setupCssCb = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">event, cb</span>) </span>{
  <span class="hljs-keyword">this</span>.pendingCssEvent = event
  <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>
  <span class="hljs-keyword">var</span> el = <span class="hljs-keyword">this</span>.el
  <span class="hljs-keyword">var</span> onEnd = <span class="hljs-keyword">this</span>.pendingCssCb = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) </span>{
    <span class="hljs-keyword">if</span> (e.target === el) {
      off(el, event, onEnd)
      self.pendingCssEvent = self.pendingCssCb = <span class="hljs-literal">null</span>
      <span class="hljs-keyword">if</span> (!self.pendingJsCb &amp;&amp; cb) {
        cb()
      }
    }
  }
  on(el, event, onEnd)
}

<span class="hljs-comment">/**
 * Check if an element is hidden - in that case we can just
 * skip the transition alltogether.
 *
 * @param {Element} el
 * @return {Boolean}
 */</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isHidden</span> (<span class="hljs-params">el</span>) </span>{
  <span class="hljs-keyword">if</span> (<span class="hljs-regexp">/svg$/</span>.test(el.namespaceURI)) {
    <span class="hljs-comment">/* SVG elements do not have offset(Width|Height) */</span>
    <span class="hljs-comment">/* so we need to check the client rect */</span>
    <span class="hljs-keyword">var</span> rect = el.getBoundingClientRect()
    <span class="hljs-keyword">return</span> !(rect.width || rect.height)
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">return</span> !(
      el.offsetWidth ||
      el.offsetHeight ||
      el.getClientRects().length
    )
  }
}</pre></div>
            </div>
        </li>
        
    </ul>
</section>
</body>
</html>
