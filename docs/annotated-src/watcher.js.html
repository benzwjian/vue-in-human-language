<!DOCTYPE html>
<html>
<head>
    <title>watcher</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta name="viewport"
        content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
    
    <link rel="stylesheet"
        media="all"
        href="../assets/file_1.css"/>
    
    <link rel="stylesheet"
        media="all"
        href="../assets/file_5.css"/>
    
    <link rel="stylesheet"
        media="all"
        href="../assets/32px.png"/>
    
    <link rel="stylesheet"
        media="all"
        href="../assets/40px.png"/>
    
    <link rel="stylesheet"
        media="all"
        href="../assets/throbber.gif"/>
    
    <link rel="stylesheet"
        media="all"
        href="../assets/file_7.css"/>
    
    <link rel="stylesheet"
        media="all"
        href="../assets/file_8.css"/>
    

    
    <script src="../assets/file_2.js"
        type="text/javascript"></script>
    
    <script src="../assets/file_3.js"
        type="text/javascript"></script>
    
    <script src="../assets/file_4.js"
        type="text/javascript"></script>
    
    <script src="../assets/file_6.js"
        type="text/javascript"></script>
    

    <script type="application/json" id="jsTreeJSON">
        [{"id":"annotated-src/filters/array-filters.js","text":"array-filters.js","icon":"jstree-file","parent":"annotated-src/filters","a_attr":{"href":"filters/array-filters.js.html"},"state":{"selected":false}},{"id":"annotated-src","text":"annotated-src","icon":"jstree-folder","parent":"#","a_attr":{"href":"."},"state":{"opened":true}},{"id":"annotated-src/cache.js","text":"cache.js","icon":"jstree-file","parent":"annotated-src","a_attr":{"href":"cache.js.html"},"state":{"selected":false}},{"id":"annotated-src/compiler","text":"compiler","icon":"jstree-folder","parent":"annotated-src","a_attr":{"href":"compiler"},"state":{"opened":false}},{"id":"annotated-src/compiler/compile-props.js","text":"compile-props.js","icon":"jstree-file","parent":"annotated-src/compiler","a_attr":{"href":"compiler/compile-props.js.html"},"state":{"selected":false}},{"id":"annotated-src/compiler/compile.js","text":"compile.js","icon":"jstree-file","parent":"annotated-src/compiler","a_attr":{"href":"compiler/compile.js.html"},"state":{"selected":false}},{"id":"annotated-src/compiler/index.js","text":"index.js","icon":"jstree-file","parent":"annotated-src/compiler","a_attr":{"href":"compiler/index.js.html"},"state":{"selected":false}},{"id":"annotated-src/compiler/resolve-slots.js","text":"resolve-slots.js","icon":"jstree-file","parent":"annotated-src/compiler","a_attr":{"href":"compiler/resolve-slots.js.html"},"state":{"selected":false}},{"id":"annotated-src/compiler/transclude.js","text":"transclude.js","icon":"jstree-file","parent":"annotated-src/compiler","a_attr":{"href":"compiler/transclude.js.html"},"state":{"selected":false}},{"id":"annotated-src/config.js","text":"config.js","icon":"jstree-file","parent":"annotated-src","a_attr":{"href":"config.js.html"},"state":{"selected":false}},{"id":"annotated-src/directive.js","text":"directive.js","icon":"jstree-file","parent":"annotated-src","a_attr":{"href":"directive.js.html"},"state":{"selected":false}},{"id":"annotated-src/directives","text":"directives","icon":"jstree-folder","parent":"annotated-src","a_attr":{"href":"directives"},"state":{"opened":false}},{"id":"annotated-src/directives/element","text":"element","icon":"jstree-folder","parent":"annotated-src/directives","a_attr":{"href":"directives/element"},"state":{"opened":false}},{"id":"annotated-src/directives/element/index.js","text":"index.js","icon":"jstree-file","parent":"annotated-src/directives/element","a_attr":{"href":"directives/element/index.js.html"},"state":{"selected":false}},{"id":"annotated-src/directives/element/partial.js","text":"partial.js","icon":"jstree-file","parent":"annotated-src/directives/element","a_attr":{"href":"directives/element/partial.js.html"},"state":{"selected":false}},{"id":"annotated-src/directives/element/slot.js","text":"slot.js","icon":"jstree-file","parent":"annotated-src/directives/element","a_attr":{"href":"directives/element/slot.js.html"},"state":{"selected":false}},{"id":"annotated-src/directives/internal","text":"internal","icon":"jstree-folder","parent":"annotated-src/directives","a_attr":{"href":"directives/internal"},"state":{"opened":false}},{"id":"annotated-src/directives/internal/class.js","text":"class.js","icon":"jstree-file","parent":"annotated-src/directives/internal","a_attr":{"href":"directives/internal/class.js.html"},"state":{"selected":false}},{"id":"annotated-src/directives/internal/component.js","text":"component.js","icon":"jstree-file","parent":"annotated-src/directives/internal","a_attr":{"href":"directives/internal/component.js.html"},"state":{"selected":false}},{"id":"annotated-src/directives/internal/index.js","text":"index.js","icon":"jstree-file","parent":"annotated-src/directives/internal","a_attr":{"href":"directives/internal/index.js.html"},"state":{"selected":false}},{"id":"annotated-src/directives/internal/prop.js","text":"prop.js","icon":"jstree-file","parent":"annotated-src/directives/internal","a_attr":{"href":"directives/internal/prop.js.html"},"state":{"selected":false}},{"id":"annotated-src/directives/internal/style.js","text":"style.js","icon":"jstree-file","parent":"annotated-src/directives/internal","a_attr":{"href":"directives/internal/style.js.html"},"state":{"selected":false}},{"id":"annotated-src/directives/internal/transition.js","text":"transition.js","icon":"jstree-file","parent":"annotated-src/directives/internal","a_attr":{"href":"directives/internal/transition.js.html"},"state":{"selected":false}},{"id":"annotated-src/directives/priorities.js","text":"priorities.js","icon":"jstree-file","parent":"annotated-src/directives","a_attr":{"href":"directives/priorities.js.html"},"state":{"selected":false}},{"id":"annotated-src/directives/public","text":"public","icon":"jstree-folder","parent":"annotated-src/directives","a_attr":{"href":"directives/public"},"state":{"opened":false}},{"id":"annotated-src/directives/public/bind.js","text":"bind.js","icon":"jstree-file","parent":"annotated-src/directives/public","a_attr":{"href":"directives/public/bind.js.html"},"state":{"selected":false}},{"id":"annotated-src/directives/public/cloak.js","text":"cloak.js","icon":"jstree-file","parent":"annotated-src/directives/public","a_attr":{"href":"directives/public/cloak.js.html"},"state":{"selected":false}},{"id":"annotated-src/directives/public/el.js","text":"el.js","icon":"jstree-file","parent":"annotated-src/directives/public","a_attr":{"href":"directives/public/el.js.html"},"state":{"selected":false}},{"id":"annotated-src/directives/public/for.js","text":"for.js","icon":"jstree-file","parent":"annotated-src/directives/public","a_attr":{"href":"directives/public/for.js.html"},"state":{"selected":false}},{"id":"annotated-src/directives/public/html.js","text":"html.js","icon":"jstree-file","parent":"annotated-src/directives/public","a_attr":{"href":"directives/public/html.js.html"},"state":{"selected":false}},{"id":"annotated-src/directives/public/if.js","text":"if.js","icon":"jstree-file","parent":"annotated-src/directives/public","a_attr":{"href":"directives/public/if.js.html"},"state":{"selected":false}},{"id":"annotated-src/directives/public/index.js","text":"index.js","icon":"jstree-file","parent":"annotated-src/directives/public","a_attr":{"href":"directives/public/index.js.html"},"state":{"selected":false}},{"id":"annotated-src/directives/public/model","text":"model","icon":"jstree-folder","parent":"annotated-src/directives/public","a_attr":{"href":"directives/public/model"},"state":{"opened":false}},{"id":"annotated-src/directives/public/model/checkbox.js","text":"checkbox.js","icon":"jstree-file","parent":"annotated-src/directives/public/model","a_attr":{"href":"directives/public/model/checkbox.js.html"},"state":{"selected":false}},{"id":"annotated-src/directives/public/model/index.js","text":"index.js","icon":"jstree-file","parent":"annotated-src/directives/public/model","a_attr":{"href":"directives/public/model/index.js.html"},"state":{"selected":false}},{"id":"annotated-src/directives/public/model/radio.js","text":"radio.js","icon":"jstree-file","parent":"annotated-src/directives/public/model","a_attr":{"href":"directives/public/model/radio.js.html"},"state":{"selected":false}},{"id":"annotated-src/directives/public/model/select.js","text":"select.js","icon":"jstree-file","parent":"annotated-src/directives/public/model","a_attr":{"href":"directives/public/model/select.js.html"},"state":{"selected":false}},{"id":"annotated-src/directives/public/model/text.js","text":"text.js","icon":"jstree-file","parent":"annotated-src/directives/public/model","a_attr":{"href":"directives/public/model/text.js.html"},"state":{"selected":false}},{"id":"annotated-src/directives/public/on.js","text":"on.js","icon":"jstree-file","parent":"annotated-src/directives/public","a_attr":{"href":"directives/public/on.js.html"},"state":{"selected":false}},{"id":"annotated-src/directives/public/ref.js","text":"ref.js","icon":"jstree-file","parent":"annotated-src/directives/public","a_attr":{"href":"directives/public/ref.js.html"},"state":{"selected":false}},{"id":"annotated-src/directives/public/show.js","text":"show.js","icon":"jstree-file","parent":"annotated-src/directives/public","a_attr":{"href":"directives/public/show.js.html"},"state":{"selected":false}},{"id":"annotated-src/directives/public/text.js","text":"text.js","icon":"jstree-file","parent":"annotated-src/directives/public","a_attr":{"href":"directives/public/text.js.html"},"state":{"selected":false}},{"id":"annotated-src/filters","text":"filters","icon":"jstree-folder","parent":"annotated-src","a_attr":{"href":"filters"},"state":{"opened":false}},{"id":"annotated-src/batcher.js","text":"batcher.js","icon":"jstree-file","parent":"annotated-src","a_attr":{"href":"batcher.js.html"},"state":{"selected":false}},{"id":"annotated-src/filters/index.js","text":"index.js","icon":"jstree-file","parent":"annotated-src/filters","a_attr":{"href":"filters/index.js.html"},"state":{"selected":false}},{"id":"annotated-src/fragment","text":"fragment","icon":"jstree-folder","parent":"annotated-src","a_attr":{"href":"fragment"},"state":{"opened":false}},{"id":"annotated-src/fragment/factory.js","text":"factory.js","icon":"jstree-file","parent":"annotated-src/fragment","a_attr":{"href":"fragment/factory.js.html"},"state":{"selected":false}},{"id":"annotated-src/fragment/fragment.js","text":"fragment.js","icon":"jstree-file","parent":"annotated-src/fragment","a_attr":{"href":"fragment/fragment.js.html"},"state":{"selected":false}},{"id":"annotated-src/global-api.js","text":"global-api.js","icon":"jstree-file","parent":"annotated-src","a_attr":{"href":"global-api.js.html"},"state":{"selected":false}},{"id":"annotated-src/index.js","text":"index.js","icon":"jstree-file","parent":"annotated-src","a_attr":{"href":"index.js.html"},"state":{"selected":false}},{"id":"annotated-src/instance","text":"instance","icon":"jstree-folder","parent":"annotated-src","a_attr":{"href":"instance"},"state":{"opened":false}},{"id":"annotated-src/instance/api","text":"api","icon":"jstree-folder","parent":"annotated-src/instance","a_attr":{"href":"instance/api"},"state":{"opened":false}},{"id":"annotated-src/instance/api/data.js","text":"data.js","icon":"jstree-file","parent":"annotated-src/instance/api","a_attr":{"href":"instance/api/data.js.html"},"state":{"selected":false}},{"id":"annotated-src/instance/api/dom.js","text":"dom.js","icon":"jstree-file","parent":"annotated-src/instance/api","a_attr":{"href":"instance/api/dom.js.html"},"state":{"selected":false}},{"id":"annotated-src/instance/api/events.js","text":"events.js","icon":"jstree-file","parent":"annotated-src/instance/api","a_attr":{"href":"instance/api/events.js.html"},"state":{"selected":false}},{"id":"annotated-src/instance/api/lifecycle.js","text":"lifecycle.js","icon":"jstree-file","parent":"annotated-src/instance/api","a_attr":{"href":"instance/api/lifecycle.js.html"},"state":{"selected":false}},{"id":"annotated-src/instance/internal","text":"internal","icon":"jstree-folder","parent":"annotated-src/instance","a_attr":{"href":"instance/internal"},"state":{"opened":false}},{"id":"annotated-src/instance/internal/events.js","text":"events.js","icon":"jstree-file","parent":"annotated-src/instance/internal","a_attr":{"href":"instance/internal/events.js.html"},"state":{"selected":false}},{"id":"annotated-src/instance/internal/init.js","text":"init.js","icon":"jstree-file","parent":"annotated-src/instance/internal","a_attr":{"href":"instance/internal/init.js.html"},"state":{"selected":false}},{"id":"annotated-src/instance/internal/lifecycle.js","text":"lifecycle.js","icon":"jstree-file","parent":"annotated-src/instance/internal","a_attr":{"href":"instance/internal/lifecycle.js.html"},"state":{"selected":false}},{"id":"annotated-src/instance/internal/misc.js","text":"misc.js","icon":"jstree-file","parent":"annotated-src/instance/internal","a_attr":{"href":"instance/internal/misc.js.html"},"state":{"selected":false}},{"id":"annotated-src/instance/internal/state.js","text":"state.js","icon":"jstree-file","parent":"annotated-src/instance/internal","a_attr":{"href":"instance/internal/state.js.html"},"state":{"selected":false}},{"id":"annotated-src/instance/vue.js","text":"vue.js","icon":"jstree-file","parent":"annotated-src/instance","a_attr":{"href":"instance/vue.js.html"},"state":{"selected":false}},{"id":"annotated-src/observer","text":"observer","icon":"jstree-folder","parent":"annotated-src","a_attr":{"href":"observer"},"state":{"opened":false}},{"id":"annotated-src/observer/array.js","text":"array.js","icon":"jstree-file","parent":"annotated-src/observer","a_attr":{"href":"observer/array.js.html"},"state":{"selected":false}},{"id":"annotated-src/observer/dep.js","text":"dep.js","icon":"jstree-file","parent":"annotated-src/observer","a_attr":{"href":"observer/dep.js.html"},"state":{"selected":false}},{"id":"annotated-src/observer/index.js","text":"index.js","icon":"jstree-file","parent":"annotated-src/observer","a_attr":{"href":"observer/index.js.html"},"state":{"selected":false}},{"id":"annotated-src/parsers","text":"parsers","icon":"jstree-folder","parent":"annotated-src","a_attr":{"href":"parsers"},"state":{"opened":false}},{"id":"annotated-src/parsers/directive.js","text":"directive.js","icon":"jstree-file","parent":"annotated-src/parsers","a_attr":{"href":"parsers/directive.js.html"},"state":{"selected":false}},{"id":"annotated-src/parsers/expression.js","text":"expression.js","icon":"jstree-file","parent":"annotated-src/parsers","a_attr":{"href":"parsers/expression.js.html"},"state":{"selected":false}},{"id":"annotated-src/parsers/path.js","text":"path.js","icon":"jstree-file","parent":"annotated-src/parsers","a_attr":{"href":"parsers/path.js.html"},"state":{"selected":false}},{"id":"annotated-src/parsers/template.js","text":"template.js","icon":"jstree-file","parent":"annotated-src/parsers","a_attr":{"href":"parsers/template.js.html"},"state":{"selected":false}},{"id":"annotated-src/parsers/text.js","text":"text.js","icon":"jstree-file","parent":"annotated-src/parsers","a_attr":{"href":"parsers/text.js.html"},"state":{"selected":false}},{"id":"annotated-src/transition","text":"transition","icon":"jstree-folder","parent":"annotated-src","a_attr":{"href":"transition"},"state":{"opened":false}},{"id":"annotated-src/transition/index.js","text":"index.js","icon":"jstree-file","parent":"annotated-src/transition","a_attr":{"href":"transition/index.js.html"},"state":{"selected":false}},{"id":"annotated-src/transition/queue.js","text":"queue.js","icon":"jstree-file","parent":"annotated-src/transition","a_attr":{"href":"transition/queue.js.html"},"state":{"selected":false}},{"id":"annotated-src/transition/transition.js","text":"transition.js","icon":"jstree-file","parent":"annotated-src/transition","a_attr":{"href":"transition/transition.js.html"},"state":{"selected":false}},{"id":"annotated-src/util","text":"util","icon":"jstree-folder","parent":"annotated-src","a_attr":{"href":"util"},"state":{"opened":false}},{"id":"annotated-src/util/component.js","text":"component.js","icon":"jstree-file","parent":"annotated-src/util","a_attr":{"href":"util/component.js.html"},"state":{"selected":false}},{"id":"annotated-src/util/debug.js","text":"debug.js","icon":"jstree-file","parent":"annotated-src/util","a_attr":{"href":"util/debug.js.html"},"state":{"selected":false}},{"id":"annotated-src/util/dom.js","text":"dom.js","icon":"jstree-file","parent":"annotated-src/util","a_attr":{"href":"util/dom.js.html"},"state":{"selected":false}},{"id":"annotated-src/util/env.js","text":"env.js","icon":"jstree-file","parent":"annotated-src/util","a_attr":{"href":"util/env.js.html"},"state":{"selected":false}},{"id":"annotated-src/util/index.js","text":"index.js","icon":"jstree-file","parent":"annotated-src/util","a_attr":{"href":"util/index.js.html"},"state":{"selected":false}},{"id":"annotated-src/util/lang.js","text":"lang.js","icon":"jstree-file","parent":"annotated-src/util","a_attr":{"href":"util/lang.js.html"},"state":{"selected":false}},{"id":"annotated-src/util/options.js","text":"options.js","icon":"jstree-file","parent":"annotated-src/util","a_attr":{"href":"util/options.js.html"},"state":{"selected":false}},{"id":"annotated-src/watcher.js","text":"watcher.js","icon":"jstree-file","parent":"annotated-src","a_attr":{"href":"watcher.js.html"},"state":{"selected":true}}]
    </script>
</head>
<body class="markdown-body">
<h1>
    watcher
</h1>
<div class="subHeading">
    annotated-src/watcher.js
</div>
<button type="button" class="navigatorToggle">&#9776; files...</button>
<nav class="navigationTree minimized">
    <input type="text" id="jsTreeSearch" placeholder="search..."/>
    <div></div>
</nav>
<section>
    <ul class="sectionDetails codeOnly">
        
        
        <li id="section-1">
            <div class="annotation">
                
            </div><div class="content">
                <div class="highlight"><pre><span class="hljs-keyword">import</span> config <span class="hljs-keyword">from</span> <span class="hljs-string">'./config'</span>
<span class="hljs-keyword">import</span> Dep <span class="hljs-keyword">from</span> <span class="hljs-string">'./observer/dep'</span>
<span class="hljs-keyword">import</span> { parseExpression } <span class="hljs-keyword">from</span> <span class="hljs-string">'./parsers/expression'</span>
<span class="hljs-keyword">import</span> { pushWatcher } <span class="hljs-keyword">from</span> <span class="hljs-string">'./batcher'</span>
<span class="hljs-keyword">import</span> {
  extend,
  warn,
  isArray,
  isObject,
  nextTick,
  _Set <span class="hljs-keyword">as</span> <span class="hljs-built_in">Set</span>
} <span class="hljs-keyword">from</span> <span class="hljs-string">'./util/index'</span>

<span class="hljs-keyword">let</span> uid = <span class="hljs-number">0</span>

<span class="hljs-comment">/**
 * A watcher parses an expression, collects dependencies,
 * and fires callback when the expression value changes.
 * This is used for both the $watch() api and directives.
 *
 * @param {Vue} vm
 * @param {String|Function} expOrFn
 * @param {Function} cb
 * @param {Object} options
 *                 - {Array} filters
 *                 - {Boolean} twoWay
 *                 - {Boolean} deep
 *                 - {Boolean} user
 *                 - {Boolean} sync
 *                 - {Boolean} lazy
 *                 - {Function} [preProcess]
 *                 - {Function} [postProcess]
 * @constructor
 */</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Watcher</span> (<span class="hljs-params">vm, expOrFn, cb, options</span>) </span>{
  <span class="hljs-comment">/* mix in options */</span>
  <span class="hljs-keyword">if</span> (options) {
    extend(<span class="hljs-keyword">this</span>, options)
  }
  <span class="hljs-keyword">var</span> isFn = <span class="hljs-keyword">typeof</span> expOrFn === <span class="hljs-string">'function'</span>
  <span class="hljs-keyword">this</span>.vm = vm
  vm._watchers.push(<span class="hljs-keyword">this</span>)
  <span class="hljs-keyword">this</span>.expression = expOrFn
  <span class="hljs-keyword">this</span>.cb = cb
  <span class="hljs-keyword">this</span>.id = ++uid <span class="hljs-comment">/* uid for batching */</span>
  <span class="hljs-keyword">this</span>.active = <span class="hljs-literal">true</span>
  <span class="hljs-keyword">this</span>.dirty = <span class="hljs-keyword">this</span>.lazy <span class="hljs-comment">/* for lazy watchers */</span>
  <span class="hljs-keyword">this</span>.deps = []
  <span class="hljs-keyword">this</span>.newDeps = []
  <span class="hljs-keyword">this</span>.depIds = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Set</span>()
  <span class="hljs-keyword">this</span>.newDepIds = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Set</span>()
  <span class="hljs-keyword">this</span>.prevError = <span class="hljs-literal">null</span> <span class="hljs-comment">/* for async error stacks */</span>
  <span class="hljs-comment">/* parse expression for getter/setter */</span>
  <span class="hljs-keyword">if</span> (isFn) {
    <span class="hljs-keyword">this</span>.getter = expOrFn
    <span class="hljs-keyword">this</span>.setter = <span class="hljs-literal">undefined</span>
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">var</span> res = parseExpression(expOrFn, <span class="hljs-keyword">this</span>.twoWay)
    <span class="hljs-keyword">this</span>.getter = res.get
    <span class="hljs-keyword">this</span>.setter = res.set
  }
  <span class="hljs-keyword">this</span>.value = <span class="hljs-keyword">this</span>.lazy
    ? <span class="hljs-literal">undefined</span>
    : <span class="hljs-keyword">this</span>.get()
  <span class="hljs-comment">/* state for avoiding false triggers for deep and Array */</span>
  <span class="hljs-comment">/* watchers during vm._digest() */</span>
  <span class="hljs-keyword">this</span>.queued = <span class="hljs-keyword">this</span>.shallow = <span class="hljs-literal">false</span>
}

<span class="hljs-comment">/**
 * Evaluate the getter, and re-collect dependencies.
 */</span>

Watcher.prototype.get = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">this</span>.beforeGet()
  <span class="hljs-keyword">var</span> scope = <span class="hljs-keyword">this</span>.scope || <span class="hljs-keyword">this</span>.vm
  <span class="hljs-keyword">var</span> value
  <span class="hljs-keyword">try</span> {
    value = <span class="hljs-keyword">this</span>.getter.call(scope, scope)
  } <span class="hljs-keyword">catch</span> (e) {
    <span class="hljs-keyword">if</span> (
      process.env.NODE_ENV !== <span class="hljs-string">'production'</span> &amp;&amp;
      config.warnExpressionErrors
    ) {
      warn(
        <span class="hljs-string">'Error when evaluating expression '</span> +
        <span class="hljs-string">'"'</span> + <span class="hljs-keyword">this</span>.expression + <span class="hljs-string">'": '</span> + e.toString(),
        <span class="hljs-keyword">this</span>.vm
      )
    }
  }
  <span class="hljs-comment">/* "touch" every property so they are all tracked as */</span>
  <span class="hljs-comment">/* dependencies for deep watching */</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.deep) {
    traverse(value)
  }
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.preProcess) {
    value = <span class="hljs-keyword">this</span>.preProcess(value)
  }
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.filters) {
    value = scope._applyFilters(value, <span class="hljs-literal">null</span>, <span class="hljs-keyword">this</span>.filters, <span class="hljs-literal">false</span>)
  }
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.postProcess) {
    value = <span class="hljs-keyword">this</span>.postProcess(value)
  }
  <span class="hljs-keyword">this</span>.afterGet()
  <span class="hljs-keyword">return</span> value
}

<span class="hljs-comment">/**
 * Set the corresponding value with the setter.
 *
 * @param {*} value
 */</span>

Watcher.prototype.set = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">value</span>) </span>{
  <span class="hljs-keyword">var</span> scope = <span class="hljs-keyword">this</span>.scope || <span class="hljs-keyword">this</span>.vm
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.filters) {
    value = scope._applyFilters(
      value, <span class="hljs-keyword">this</span>.value, <span class="hljs-keyword">this</span>.filters, <span class="hljs-literal">true</span>)
  }
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">this</span>.setter.call(scope, scope, value)
  } <span class="hljs-keyword">catch</span> (e) {
    <span class="hljs-keyword">if</span> (
      process.env.NODE_ENV !== <span class="hljs-string">'production'</span> &amp;&amp;
      config.warnExpressionErrors
    ) {
      warn(
        <span class="hljs-string">'Error when evaluating setter '</span> +
        <span class="hljs-string">'"'</span> + <span class="hljs-keyword">this</span>.expression + <span class="hljs-string">'": '</span> + e.toString(),
        <span class="hljs-keyword">this</span>.vm
      )
    }
  }
  <span class="hljs-comment">/* two-way sync for v-for alias */</span>
  <span class="hljs-keyword">var</span> forContext = scope.$forContext
  <span class="hljs-keyword">if</span> (forContext &amp;&amp; forContext.alias === <span class="hljs-keyword">this</span>.expression) {
    <span class="hljs-keyword">if</span> (forContext.filters) {
      process.env.NODE_ENV !== <span class="hljs-string">'production'</span> &amp;&amp; warn(
        <span class="hljs-string">'It seems you are using two-way binding on '</span> +
        <span class="hljs-string">'a v-for alias ('</span> + <span class="hljs-keyword">this</span>.expression + <span class="hljs-string">'), and the '</span> +
        <span class="hljs-string">'v-for has filters. This will not work properly. '</span> +
        <span class="hljs-string">'Either remove the filters or use an array of '</span> +
        <span class="hljs-string">'objects and bind to object properties instead.'</span>,
        <span class="hljs-keyword">this</span>.vm
      )
      <span class="hljs-keyword">return</span>
    }
    forContext._withLock(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">if</span> (scope.$key) { <span class="hljs-comment">/* original is an object */</span>
        forContext.rawValue[scope.$key] = value
      } <span class="hljs-keyword">else</span> {
        forContext.rawValue.$set(scope.$index, value)
      }
    })
  }
}

<span class="hljs-comment">/**
 * Prepare for dependency collection.
 */</span>

Watcher.prototype.beforeGet = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
  Dep.target = <span class="hljs-keyword">this</span>
}

<span class="hljs-comment">/**
 * Add a dependency to this directive.
 *
 * @param {Dep} dep
 */</span>

Watcher.prototype.addDep = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">dep</span>) </span>{
  <span class="hljs-keyword">var</span> id = dep.id
  <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.newDepIds.has(id)) {
    <span class="hljs-keyword">this</span>.newDepIds.add(id)
    <span class="hljs-keyword">this</span>.newDeps.push(dep)
    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.depIds.has(id)) {
      dep.addSub(<span class="hljs-keyword">this</span>)
    }
  }
}

<span class="hljs-comment">/**
 * Clean up for dependency collection.
 */</span>

Watcher.prototype.afterGet = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
  Dep.target = <span class="hljs-literal">null</span>
  <span class="hljs-keyword">var</span> i = <span class="hljs-keyword">this</span>.deps.length
  <span class="hljs-keyword">while</span> (i--) {
    <span class="hljs-keyword">var</span> dep = <span class="hljs-keyword">this</span>.deps[i]
    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.newDepIds.has(dep.id)) {
      dep.removeSub(<span class="hljs-keyword">this</span>)
    }
  }
  <span class="hljs-keyword">var</span> tmp = <span class="hljs-keyword">this</span>.depIds
  <span class="hljs-keyword">this</span>.depIds = <span class="hljs-keyword">this</span>.newDepIds
  <span class="hljs-keyword">this</span>.newDepIds = tmp
  <span class="hljs-keyword">this</span>.newDepIds.clear()
  tmp = <span class="hljs-keyword">this</span>.deps
  <span class="hljs-keyword">this</span>.deps = <span class="hljs-keyword">this</span>.newDeps
  <span class="hljs-keyword">this</span>.newDeps = tmp
  <span class="hljs-keyword">this</span>.newDeps.length = <span class="hljs-number">0</span>
}

<span class="hljs-comment">/**
 * Subscriber interface.
 * Will be called when a dependency changes.
 *
 * @param {Boolean} shallow
 */</span>

Watcher.prototype.update = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">shallow</span>) </span>{
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.lazy) {
    <span class="hljs-keyword">this</span>.dirty = <span class="hljs-literal">true</span>
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.sync || !config.async) {
    <span class="hljs-keyword">this</span>.run()
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">/* if queued, only overwrite shallow with non-shallow, */</span>
    <span class="hljs-comment">/* but not the other way around. */</span>
    <span class="hljs-keyword">this</span>.shallow = <span class="hljs-keyword">this</span>.queued
      ? shallow
        ? <span class="hljs-keyword">this</span>.shallow
        : <span class="hljs-literal">false</span>
      : !!shallow
    <span class="hljs-keyword">this</span>.queued = <span class="hljs-literal">true</span>
    <span class="hljs-comment">/* record before-push error stack in debug mode */</span>
    <span class="hljs-comment">/* istanbul ignore if */</span>
    <span class="hljs-keyword">if</span> (process.env.NODE_ENV !== <span class="hljs-string">'production'</span> &amp;&amp; config.debug) {
      <span class="hljs-keyword">this</span>.prevError = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'[vue] async stack trace'</span>)
    }
    pushWatcher(<span class="hljs-keyword">this</span>)
  }
}

<span class="hljs-comment">/**
 * Batcher job interface.
 * Will be called by the batcher.
 */</span>

Watcher.prototype.run = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.active) {
    <span class="hljs-keyword">var</span> value = <span class="hljs-keyword">this</span>.get()
    <span class="hljs-keyword">if</span> (
      value !== <span class="hljs-keyword">this</span>.value ||
      <span class="hljs-comment">/* Deep watchers and watchers on Object/Arrays should fire even */</span>
      <span class="hljs-comment">/* when the value is the same, because the value may */</span>
      <span class="hljs-comment">/* have mutated; but only do so if this is a */</span>
      <span class="hljs-comment">/* non-shallow update (caused by a vm digest). */</span>
      ((isObject(value) || <span class="hljs-keyword">this</span>.deep) &amp;&amp; !<span class="hljs-keyword">this</span>.shallow)
    ) {
      <span class="hljs-comment">/* set new value */</span>
      <span class="hljs-keyword">var</span> oldValue = <span class="hljs-keyword">this</span>.value
      <span class="hljs-keyword">this</span>.value = value
      <span class="hljs-comment">/* in debug + async mode, when a watcher callbacks */</span>
      <span class="hljs-comment">/* throws, we also throw the saved before-push error */</span>
      <span class="hljs-comment">/* so the full cross-tick stack trace is available. */</span>
      <span class="hljs-keyword">var</span> prevError = <span class="hljs-keyword">this</span>.prevError
      <span class="hljs-comment">/* istanbul ignore if */</span>
      <span class="hljs-keyword">if</span> (process.env.NODE_ENV !== <span class="hljs-string">'production'</span> &amp;&amp;
          config.debug &amp;&amp; prevError) {
        <span class="hljs-keyword">this</span>.prevError = <span class="hljs-literal">null</span>
        <span class="hljs-keyword">try</span> {
          <span class="hljs-keyword">this</span>.cb.call(<span class="hljs-keyword">this</span>.vm, value, oldValue)
        } <span class="hljs-keyword">catch</span> (e) {
          nextTick(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">throw</span> prevError
          }, <span class="hljs-number">0</span>)
          <span class="hljs-keyword">throw</span> e
        }
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">this</span>.cb.call(<span class="hljs-keyword">this</span>.vm, value, oldValue)
      }
    }
    <span class="hljs-keyword">this</span>.queued = <span class="hljs-keyword">this</span>.shallow = <span class="hljs-literal">false</span>
  }
}

<span class="hljs-comment">/**
 * Evaluate the value of the watcher.
 * This only gets called for lazy watchers.
 */</span>

Watcher.prototype.evaluate = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
  <span class="hljs-comment">/* avoid overwriting another watcher that is being */</span>
  <span class="hljs-comment">/* collected. */</span>
  <span class="hljs-keyword">var</span> current = Dep.target
  <span class="hljs-keyword">this</span>.value = <span class="hljs-keyword">this</span>.get()
  <span class="hljs-keyword">this</span>.dirty = <span class="hljs-literal">false</span>
  Dep.target = current
}

<span class="hljs-comment">/**
 * Depend on all deps collected by this watcher.
 */</span>

Watcher.prototype.depend = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">var</span> i = <span class="hljs-keyword">this</span>.deps.length
  <span class="hljs-keyword">while</span> (i--) {
    <span class="hljs-keyword">this</span>.deps[i].depend()
  }
}

<span class="hljs-comment">/**
 * Remove self from all dependencies' subcriber list.
 */</span>

Watcher.prototype.teardown = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.active) {
    <span class="hljs-comment">/* remove self from vm's watcher list */</span>
    <span class="hljs-comment">/* this is a somewhat expensive operation so we skip it */</span>
    <span class="hljs-comment">/* if the vm is being destroyed or is performing a v-for */</span>
    <span class="hljs-comment">/* re-render (the watcher list is then filtered by v-for). */</span>
    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.vm._isBeingDestroyed &amp;&amp; !<span class="hljs-keyword">this</span>.vm._vForRemoving) {
      <span class="hljs-keyword">this</span>.vm._watchers.$remove(<span class="hljs-keyword">this</span>)
    }
    <span class="hljs-keyword">var</span> i = <span class="hljs-keyword">this</span>.deps.length
    <span class="hljs-keyword">while</span> (i--) {
      <span class="hljs-keyword">this</span>.deps[i].removeSub(<span class="hljs-keyword">this</span>)
    }
    <span class="hljs-keyword">this</span>.active = <span class="hljs-literal">false</span>
    <span class="hljs-keyword">this</span>.vm = <span class="hljs-keyword">this</span>.cb = <span class="hljs-keyword">this</span>.value = <span class="hljs-literal">null</span>
  }
}

<span class="hljs-comment">/**
 * Recrusively traverse an object to evoke all converted
 * getters, so that every nested property inside the object
 * is collected as a "deep" dependency.
 *
 * @param {*} val
 */</span>

<span class="hljs-keyword">const</span> seenObjects = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Set</span>()
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">traverse</span> (<span class="hljs-params">val, seen</span>) </span>{
  <span class="hljs-keyword">let</span> i, keys
  <span class="hljs-keyword">if</span> (!seen) {
    seen = seenObjects
    seen.clear()
  }
  <span class="hljs-keyword">const</span> isA = isArray(val)
  <span class="hljs-keyword">const</span> isO = isObject(val)
  <span class="hljs-keyword">if</span> ((isA || isO) &amp;&amp; <span class="hljs-built_in">Object</span>.isExtensible(val)) {
    <span class="hljs-keyword">if</span> (val.__ob__) {
      <span class="hljs-keyword">var</span> depId = val.__ob__.dep.id
      <span class="hljs-keyword">if</span> (seen.has(depId)) {
        <span class="hljs-keyword">return</span>
      } <span class="hljs-keyword">else</span> {
        seen.add(depId)
      }
    }
    <span class="hljs-keyword">if</span> (isA) {
      i = val.length
      <span class="hljs-keyword">while</span> (i--) traverse(val[i], seen)
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (isO) {
      keys = <span class="hljs-built_in">Object</span>.keys(val)
      i = keys.length
      <span class="hljs-keyword">while</span> (i--) traverse(val[keys[i]], seen)
    }
  }
}</pre></div>
            </div>
        </li>
        
    </ul>
</section>
</body>
</html>
